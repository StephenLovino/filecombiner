FROM gitpod/workspace-full

# Install Android SDK dependencies
RUN sudo apt-get update \
    && sudo apt-get install -y --no-install-recommends \
        libc6-i386 \
        lib32stdc++6 \
        lib32gcc1 \
        lib32ncurses5 \
        lib32z1 \
        unzip \
    && sudo rm -rf /var/lib/apt/lists/*

# Set environment variables
ENV ANDROID_HOME=/home/gitpod/android-sdk-linux
ENV PATH=${PATH}:${ANDROID_HOME}/tools:${ANDROID_HOME}/tools/bin:${ANDROID_HOME}/platform-tools

# Download and install Android SDK command line tools
RUN mkdir -p ${ANDROID_HOME} \
    && curl -o sdk-tools.zip https://dl.google.com/android/repository/commandlinetools-linux-7583922_latest.zip \
    && unzip sdk-tools.zip -d ${ANDROID_HOME}/cmdline-tools \
    && rm sdk-tools.zip \
    && mv ${ANDROID_HOME}/cmdline-tools/cmdline-tools ${ANDROID_HOME}/cmdline-tools/tools

# Accept licenses and install necessary packages
RUN yes | ${ANDROID_HOME}/cmdline-tools/tools/bin/sdkmanager --licenses \
    && ${ANDROID_HOME}/cmdline-tools/tools/bin/sdkmanager "platform-tools" "platforms;android-30" "build-tools;30.0.3"